<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™êµ WiFi ë³´ì•ˆ ë¶„ì„ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #4c63d2;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            color: #4c63d2;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #e0e8ff;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4c63d2;
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4c63d2 0%, #5a67d8 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 99, 210, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .wifi-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            padding: 15px;
            background: #f8fafc;
        }

        .wifi-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #4c63d2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .wifi-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .wifi-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .wifi-details {
            font-size: 12px;
            color: #666;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .security-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .security-open { background: #fed7d7; color: #c53030; }
        .security-wep { background: #feebc8; color: #dd6b20; }
        .security-wpa { background: #c6f6d5; color: #2f855a; }
        .security-wpa2 { background: #bee3f8; color: #2b6cb0; }
        .security-wpa3 { background: #d6f5d6; color: #22543d; }

        .signal-strength {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .signal-bars {
            display: flex;
            gap: 2px;
            align-items: end;
        }

        .signal-bar {
            width: 4px;
            background: #e2e8f0;
            border-radius: 2px;
        }

        .signal-bar.active { background: #4c63d2; }
        .signal-bar:nth-child(1) { height: 8px; }
        .signal-bar:nth-child(2) { height: 12px; }
        .signal-bar:nth-child(3) { height: 16px; }
        .signal-bar:nth-child(4) { height: 20px; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #4c63d2;
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .risk-indicator {
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .risk-low { background: #c6f6d5; color: #22543d; }
        .risk-medium { background: #feebc8; color: #dd6b20; }
        .risk-high { background: #fed7d7; color: #c53030; }

        .export-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .wifi-details {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4c63d2;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”’ í•™êµ WiFi ë³´ì•ˆ ë¶„ì„ê¸°</h1>
            <p>WiFi ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì·¨ì•½ì ì„ ë¶„ì„í•˜ê³  ì•ˆì „í•œ í•™êµ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ êµ¬ì¶•í•´ë³´ì„¸ìš”</p>
        </div>

        <div class="main-content">
            <!-- ì¸¡ì • ì„¤ì • íŒ¨ë„ -->
            <div class="card">
                <h2>ğŸ“ ì¸¡ì • ì„¤ì •</h2>
                <div class="form-group">
                    <label for="location">ì¸¡ì • ìœ„ì¹˜</label>
                    <select id="location">
                        <option value="">ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="êµì‹¤-1ì¸µ-101í˜¸">êµì‹¤ - 1ì¸µ 101í˜¸</option>
                        <option value="êµì‹¤-1ì¸µ-102í˜¸">êµì‹¤ - 1ì¸µ 102í˜¸</option>
                        <option value="êµì‹¤-2ì¸µ-201í˜¸">êµì‹¤ - 2ì¸µ 201í˜¸</option>
                        <option value="êµì‹¤-2ì¸µ-202í˜¸">êµì‹¤ - 2ì¸µ 202í˜¸</option>
                        <option value="ë„ì„œê´€-1ì¸µ">ë„ì„œê´€ - 1ì¸µ</option>
                        <option value="ë„ì„œê´€-2ì¸µ">ë„ì„œê´€ - 2ì¸µ</option>
                        <option value="ë³µë„-1ì¸µ">ë³µë„ - 1ì¸µ</option>
                        <option value="ë³µë„-2ì¸µ">ë³µë„ - 2ì¸µ</option>
                        <option value="ì¹´í˜í…Œë¦¬ì•„">ì¹´í˜í…Œë¦¬ì•„</option>
                        <option value="ìš´ë™ì¥">ìš´ë™ì¥</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="customLocation">ê¸°íƒ€ ìœ„ì¹˜ (ì§ì ‘ ì…ë ¥)</label>
                    <input type="text" id="customLocation" placeholder="ì˜ˆ: 3ì¸µ ê³¼í•™ì‹¤">
                </div>

                <div class="form-group">
                    <label for="measurer">ì¸¡ì •ì</label>
                    <input type="text" id="measurer" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="notes">íŠ¹ì´ì‚¬í•­</label>
                    <textarea id="notes" rows="3" placeholder="ì¸¡ì • í™˜ê²½, ì¸ì› ìˆ˜, íŠ¹ë³„í•œ ìƒí™© ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”"></textarea>
                </div>

                <button class="btn" onclick="startWiFiScan()">ğŸ“¡ WiFi ìŠ¤ìº” ì‹œì‘</button>
                <button class="btn btn-secondary" onclick="addManualEntry()">âœï¸ ìˆ˜ë™ ì…ë ¥</button>
            </div>

            <!-- WiFi ìŠ¤ìº” ê²°ê³¼ -->
            <div class="card">
                <h2>ğŸ“¶ ê²€ìƒ‰ëœ WiFi ë„¤íŠ¸ì›Œí¬</h2>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>WiFi ë„¤íŠ¸ì›Œí¬ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>

                <div id="wifiStatus" style="margin-bottom: 15px; padding: 10px; background: #e2e8f0; border-radius: 8px; text-align: center;">
                    <p>ğŸ“¡ ìŠ¤ìº” ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ WiFi ë„¤íŠ¸ì›Œí¬ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”</p>
                </div>

                <div class="wifi-list" id="wifiList">
                    <!-- WiFi ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <button class="btn btn-secondary" onclick="refreshScan()" style="margin-top: 15px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
        </div>

        <!-- ìˆ˜ë™ ì…ë ¥ ëª¨ë‹¬ -->
        <div class="card full-width" id="manualEntrySection" style="display: none;">
            <h2>âœï¸ WiFi ì •ë³´ ìˆ˜ë™ ì…ë ¥</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label for="manualSSID">ë„¤íŠ¸ì›Œí¬ ì´ë¦„ (SSID)</label>
                    <input type="text" id="manualSSID" placeholder="WiFi ì´ë¦„">
                </div>
                <div class="form-group">
                    <label for="manualSignal">ì‹ í˜¸ ê°•ë„ (dBm)</label>
                    <input type="number" id="manualSignal" placeholder="-50" min="-100" max="-20">
                </div>
                <div class="form-group">
                    <label for="manualSecurity">ë³´ì•ˆ ë°©ì‹</label>
                    <select id="manualSecurity">
                        <option value="Open">Open (ë³´ì•ˆ ì—†ìŒ)</option>
                        <option value="WEP">WEP</option>
                        <option value="WPA">WPA</option>
                        <option value="WPA2">WPA2</option>
                        <option value="WPA3">WPA3</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="manualChannel">ì±„ë„</label>
                    <input type="number" id="manualChannel" placeholder="6" min="1" max="14">
                </div>
            </div>
            <button class="btn" onclick="saveManualEntry()">ğŸ’¾ ì €ì¥</button>
            <button class="btn btn-danger" onclick="cancelManualEntry()">âŒ ì·¨ì†Œ</button>
        </div>

        <!-- ì¸¡ì • ë°ì´í„° í…Œì´ë¸” -->
        <div class="card full-width">
            <h2>ğŸ“Š ì¸¡ì • ë°ì´í„°</h2>
            
            <!-- í†µê³„ ìš”ì•½ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalNetworks">0</div>
                    <div class="stat-label">ì´ ë„¤íŠ¸ì›Œí¬ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="openNetworks">0</div>
                    <div class="stat-label">ì˜¤í”ˆ ë„¤íŠ¸ì›Œí¬</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgSignal">0</div>
                    <div class="stat-label">í‰ê·  ì‹ í˜¸ê°•ë„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="riskScore">0</div>
                    <div class="stat-label">ìœ„í—˜ë„ ì ìˆ˜</div>
                </div>
            </div>

            <table class="data-table" id="dataTable">
                <thead>
                    <tr>
                        <th>ì‹œê°„</th>
                        <th>ìœ„ì¹˜</th>
                        <th>ë„¤íŠ¸ì›Œí¬ëª…</th>
                        <th>ì‹ í˜¸ê°•ë„</th>
                        <th>ë³´ì•ˆë°©ì‹</th>
                        <th>ì±„ë„</th>
                        <th>ìœ„í—˜ë„</th>
                        <th>ë™ì‘</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ì¸¡ì • ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </tbody>
            </table>

            <!-- ë°ì´í„° ë‚´ë³´ë‚´ê¸° -->
            <div class="export-section">
                <h3>ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                <button class="btn" onclick="exportToCSV()">ğŸ“„ CSVë¡œ ë‚´ë³´ë‚´ê¸°</button>
                <button class="btn btn-secondary" onclick="exportToJSON()">ğŸ“‹ JSONìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let measurementData = [];
        let currentLocation = '';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = function() {
            loadSavedData();
            updateStatistics();
            renderTable();
        };

        // WiFi ìŠ¤ìº” ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Web API ì‚¬ìš©)
        function startWiFiScan() {
            const location = document.getElementById('location').value || document.getElementById('customLocation').value;
            if (!location) {
                alert('ì¸¡ì • ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            currentLocation = location;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('wifiStatus').innerHTML = '<p>ğŸ” WiFi ë„¤íŠ¸ì›Œí¬ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</p>';

            // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” navigator.mediaDevices ë˜ëŠ” WebRTC API ì‚¬ìš©
            setTimeout(() => {
                simulateWiFiScan();
                document.getElementById('loading').style.display = 'none';
            }, 2000);
        }

        // WiFi ìŠ¤ìº” ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°
        function simulateWiFiScan() {
            const sampleNetworks = [
                { ssid: 'SchoolWiFi_Main', signal: -45, security: 'WPA2', channel: 6, frequency: '2.4GHz' },
                { ssid: 'SchoolWiFi_Guest', signal: -52, security: 'WPA2', channel: 11, frequency: '2.4GHz' },
                { ssid: 'Student_Hotspot_1', signal: -67, security: 'WPA2', channel: 1, frequency: '2.4GHz' },
                { ssid: 'FreeWiFi', signal: -72, security: 'Open', channel: 3, frequency: '2.4GHz' },
                { ssid: 'Teacher_Mobile', signal: -58, security: 'WPA2', channel: 9, frequency: '2.4GHz' },
                { ssid: 'OldRouter', signal: -75, security: 'WEP', channel: 2, frequency: '2.4GHz' },
                { ssid: 'Cafe_WiFi', signal: -68, security: 'WPA3', channel: 36, frequency: '5GHz' }
            ];

            // ëœë¤í•˜ê²Œ ì¼ë¶€ ë„¤íŠ¸ì›Œí¬ë§Œ í‘œì‹œ (ì‹¤ì œ í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜)
            const detectedNetworks = sampleNetworks.filter(() => Math.random() > 0.3);
            
            displayWiFiNetworks(detectedNetworks);
            document.getElementById('wifiStatus').innerHTML = `<p>âœ… ${detectedNetworks.length}ê°œì˜ WiFi ë„¤íŠ¸ì›Œí¬ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤</p>`;
        }

        // WiFi ë„¤íŠ¸ì›Œí¬ ëª©ë¡ í‘œì‹œ
        function displayWiFiNetworks(networks) {
            const wifiList = document.getElementById('wifiList');
            wifiList.innerHTML = '';

            networks.forEach(network => {
                const wifiItem = document.createElement('div');
                wifiItem.className = 'wifi-item';
                wifiItem.innerHTML = `
                    <div class="wifi-name">${network.ssid}</div>
                    <div class="wifi-details">
                        <div>
                            <div class="signal-strength">
                                ì‹ í˜¸: ${network.signal} dBm
                                <div class="signal-bars">
                                    ${generateSignalBars(network.signal)}
                                </div>
                            </div>
                        </div>
                        <div>
                            <span class="security-badge security-${network.security.toLowerCase()}">${network.security}</span>
                        </div>
                        <div>ì±„ë„: ${network.channel}</div>
                        <div>ì£¼íŒŒìˆ˜: ${network.frequency}</div>
                    </div>
                    <button class="btn" style="margin-top: 10px; font-size: 12px;" onclick="addToMeasurement('${network.ssid}', ${network.signal}, '${network.security}', ${network.channel})">
                        ğŸ“Š ì¸¡ì • ë°ì´í„°ì— ì¶”ê°€
                    </button>
                `;
                wifiList.appendChild(wifiItem);
            });
        }

        // ì‹ í˜¸ ê°•ë„ ë°” ìƒì„±
        function generateSignalBars(signal) {
            const strength = Math.min(4, Math.max(1, Math.floor((-signal + 100) / 20)));
            let bars = '';
            for (let i = 1; i <= 4; i++) {
                bars += `<div class="signal-bar ${i <= strength ? 'active' : ''}"></div>`;
            }
            return bars;
        }

        // ì¸¡ì • ë°ì´í„°ì— ì¶”ê°€
        function addToMeasurement(ssid, signal, security, channel) {
            const measurer = document.getElementById('measurer').value;
            const notes = document.getElementById('notes').value;
            
            if (!measurer) {
                alert('ì¸¡ì •ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const measurement = {
                timestamp: new Date().toLocaleString('ko-KR'),
                location: currentLocation,
                ssid: ssid,
                signal: signal,
                security: security,
                channel: channel,
                measurer: measurer,
                notes: notes,
                riskLevel: calculateRiskLevel(security, signal)
            };

            measurementData.push(measurement);
            saveData();
            updateStatistics();
            renderTable();
            
            alert(`${ssid} ë„¤íŠ¸ì›Œí¬ê°€ ì¸¡ì • ë°ì´í„°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ìœ„í—˜ë„ ê³„ì‚°
        function calculateRiskLevel(security, signal) {
            let risk = 0;
            
            // ë³´ì•ˆ ë°©ì‹ì— ë”°ë¥¸ ìœ„í—˜ë„
            switch(security) {
                case 'Open': risk += 40; break;
                case 'WEP': risk += 30; break;
                case 'WPA': risk += 20; break;
                case 'WPA2': risk += 10; break;
                case 'WPA3': risk += 0; break;
            }
            
            // ì‹ í˜¸ ê°•ë„ì— ë”°ë¥¸ ìœ„í—˜ë„ (ë„ˆë¬´ ê°•í•˜ê±°ë‚˜ ì•½í•˜ë©´ ìœ„í—˜)
            if (signal > -40) risk += 20; // ë„ˆë¬´ ê°•í•œ ì‹ í˜¸
            else if (signal < -80) risk += 15; // ë„ˆë¬´ ì•½í•œ ì‹ í˜¸
            
            if (risk >= 50) return 'high';
            else if (risk >= 25) return 'medium';
            else return 'low';
        }

        // ìˆ˜ë™ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
        function addManualEntry() {
            const location = document.getElementById('location').value || document.getElementById('customLocation').value;
            if (!location) {
                alert('ì¸¡ì • ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            currentLocation = location;
            document.getElementById('manualEntrySection').style.display = 'block';
        }

        // ìˆ˜ë™ ì…ë ¥ ì €ì¥
        function saveManualEntry() {
            const ssid = document.getElementById('manualSSID').value;
            const signal = parseInt(document.getElementById('manualSignal').value);
            const security = document.getElementById('manualSecurity').value;
            const channel = parseInt(document.getElementById('manualChannel').value);
            const measurer = document.getElementById('measurer').value;
            const notes = document.getElementById('notes').value;

            if (!ssid || !signal || !security || !channel || !measurer) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const measurement = {
                timestamp: new Date().toLocaleString('ko-KR'),
                location: currentLocation,
                ssid: ssid,
                signal: signal,
                security: security,
                channel: channel,
                measurer: measurer,
                notes: notes,
                riskLevel: calculateRiskLevel(security, signal)
            };

            measurementData.push(measurement);
            saveData();
            updateStatistics();
            renderTable();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('manualSSID').value = '';
            document.getElementById('manualSignal').value = '';
            document.getElementById('manualChannel').value = '';
            
            alert('ì¸¡ì • ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            cancelManualEntry();
        }

        // ìˆ˜ë™ ì…ë ¥ ì·¨ì†Œ
        function cancelManualEntry() {
            document.getElementById('manualEntrySection').style.display = 'none';
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const totalNetworks = measurementData.length;
            const openNetworks = measurementData.filter(d => d.security === 'Open').length;
            const avgSignal = totalNetworks > 0 ? 
                Math.round(measurementData.reduce((sum, d) => sum + d.signal, 0) / totalNetworks) : 0;
            
            // ìœ„í—˜ë„ ì ìˆ˜ ê³„ì‚°
            let riskScore = 0;
            if (totalNetworks > 0) {
                const openRatio = openNetworks / totalNetworks;
                const weakSignals = measurementData.filter(d => d.signal < -70).length / totalNetworks;
                const highRiskNetworks = measurementData.filter(d => d.riskLevel === 'high').length / totalNetworks;
                
                riskScore = Math.round((openRatio * 40 + weakSignals * 30 + highRiskNetworks * 30));
            }

            document.getElementById('totalNetworks').textContent = totalNetworks;
            document.getElementById('openNetworks').textContent = openNetworks;
            document.getElementById('avgSignal').textContent = avgSignal + ' dBm';
            document.getElementById('riskScore').textContent = riskScore + '/100';
        }

        // í…Œì´ë¸” ë Œë”ë§
        function renderTable() {
            const tableBody = document.querySelector('#dataTable tbody');
            tableBody.innerHTML = '';

            measurementData.forEach((data, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.timestamp}</td>
                    <td>${data.location}</td>
                    <td>${data.ssid}</td>
                    <td>${data.signal} dBm</td>
                    <td><span class="security-badge security-${data.security.toLowerCase()}">${data.security}</span></td>
                    <td>${data.channel}</td>
                    <td><span class="risk-indicator risk-${data.riskLevel}">${getRiskText(data.riskLevel)}</span></td>
                    <td><button class="btn btn-danger" style="font-size: 12px;" onclick="deleteEntry(${index})">ì‚­ì œ</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // ìœ„í—˜ë„ í…ìŠ¤íŠ¸ ë³€í™˜
        function getRiskText(riskLevel) {
            switch(riskLevel) {
                case 'low': return 'ë‚®ìŒ';
                case 'medium': return 'ë³´í†µ';
                case 'high': return 'ë†’ìŒ';
                default: return 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        }

        // ë°ì´í„° ì‚­ì œ
        function deleteEntry(index) {
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                measurementData.splice(index, 1);
                saveData();
                updateStatistics();
                renderTable();
            }
        }

        // CSV ë‚´ë³´ë‚´ê¸°
        function exportToCSV() {
            if (measurementData.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const headers = ['ì‹œê°„', 'ìœ„ì¹˜', 'ë„¤íŠ¸ì›Œí¬ëª…', 'ì‹ í˜¸ê°•ë„(dBm)', 'ë³´ì•ˆë°©ì‹', 'ì±„ë„', 'ìœ„í—˜ë„', 'ì¸¡ì •ì', 'íŠ¹ì´ì‚¬í•­'];
            const csvContent = [
                headers.join(','),
                ...measurementData.map(data => [
                    `"${data.timestamp}"`,
                    `"${data.location}"`,
                    `"${data.ssid}"`,
                    data.signal,
                    data.security,
                    data.channel,
                    getRiskText(data.riskLevel),
                    `"${data.measurer}"`,
                    `"${data.notes || ''}"`
                ].join(','))
            ].join('\n');

            downloadFile(csvContent, 'wifi_security_analysis.csv', 'text/csv');
        }

        // JSON ë‚´ë³´ë‚´ê¸°
        function exportToJSON() {
            if (measurementData.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const jsonContent = JSON.stringify({
                exportDate: new Date().toISOString(),
                totalMeasurements: measurementData.length,
                data: measurementData
            }, null, 2);

            downloadFile(jsonContent, 'wifi_security_analysis.json', 'application/json');
        }

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ëª¨ë“  ë°ì´í„° ì‚­ì œ
        function clearAllData() {
            if (confirm('ëª¨ë“  ì¸¡ì • ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                measurementData = [];
                saveData();
                updateStatistics();
                renderTable();
                alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìŠ¤ìº” ìƒˆë¡œê³ ì¹¨
        function refreshScan() {
            if (currentLocation) {
                startWiFiScan();
            } else {
                alert('ë¨¼ì € ì¸¡ì • ìœ„ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            try {
                localStorage.setItem('wifiMeasurementData', JSON.stringify(measurementData));
            } catch (e) {
                console.warn('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', e);
            }
        }

        // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('wifiMeasurementData');
                if (savedData) {
                    measurementData = JSON.parse(savedData);
                }
            } catch (e) {
                console.warn('ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', e);
                measurementData = [];
            }
        }

        // ì‹¤ì œ WiFi ìŠ¤ìº” (ë¸Œë¼ìš°ì € ì§€ì› ì‹œ)
        async function attemptRealWiFiScan() {
            try {
                // Web APIë¥¼ í†µí•œ ì‹¤ì œ WiFi ìŠ¤ìº” (ì œí•œì  ì§€ì›)
                if ('navigator' in window && 'wifi' in navigator) {
                    const networks = await navigator.wifi.scan();
                    return networks;
                } else {
                    // ëŒ€ì•ˆ: ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ì‚¬ìš©
                    return null;
                }
            } catch (error) {
                console.log('ì‹¤ì œ WiFi ìŠ¤ìº” ë¶ˆê°€ëŠ¥, ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ ì‚¬ìš©');
                return null;
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        exportToCSV();
                        break;
                    case 'n':
                        e.preventDefault();
                        addManualEntry();
                        break;
                    case 'r':
                        e.preventDefault();
                        refreshScan();
                        break;
                }
            }
        });

        // ìœ„ì¹˜ ë³€ê²½ ì‹œ ìë™ ì—…ë°ì´íŠ¸
        document.getElementById('location').addEventListener('change', function() {
            currentLocation = this.value;
        });

        document.getElementById('customLocation').addEventListener('input', function() {
            if (this.value) {
                document.getElementById('location').value = '';
                currentLocation = this.value;
            }
        });

        // ë„ì›€ë§ ê¸°ëŠ¥
        function showHelp() {
            alert(`
WiFi ë³´ì•ˆ ë¶„ì„ê¸° ì‚¬ìš©ë²•:

1. ì¸¡ì • ì„¤ì •
   - ìœ„ì¹˜ ì„ íƒ ë˜ëŠ” ì§ì ‘ ì…ë ¥
   - ì¸¡ì •ì ì´ë¦„ ì…ë ¥
   - íŠ¹ì´ì‚¬í•­ ê¸°ë¡

2. WiFi ìŠ¤ìº”
   - "WiFi ìŠ¤ìº” ì‹œì‘" ë²„íŠ¼ í´ë¦­
   - ê²€ìƒ‰ëœ ë„¤íŠ¸ì›Œí¬ ì¤‘ ë¶„ì„í•  í•­ëª© ì„ íƒ

3. ìˆ˜ë™ ì…ë ¥
   - ìŠ¤ìº”ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš° ì§ì ‘ ì…ë ¥
   - ëª¨ë“  í•„ë“œë¥¼ ì •í™•íˆ ì…ë ¥

4. ë°ì´í„° ê´€ë¦¬
   - CSV/JSON í˜•íƒœë¡œ ë‚´ë³´ë‚´ê¸°
   - ë¶ˆí•„ìš”í•œ ë°ì´í„° ì‚­ì œ

5. ë‹¨ì¶•í‚¤
   - Ctrl+S: CSV ë‚´ë³´ë‚´ê¸°
   - Ctrl+N: ìˆ˜ë™ ì…ë ¥
   - Ctrl+R: ìŠ¤ìº” ìƒˆë¡œê³ ì¹¨

ìœ„í—˜ë„ í‰ê°€:
- ë†’ìŒ: Open/WEP ë„¤íŠ¸ì›Œí¬, ë¹„ì •ìƒ ì‹ í˜¸
- ë³´í†µ: êµ¬í˜• ë³´ì•ˆ ë°©ì‹
- ë‚®ìŒ: WPA2/WPA3 ë³´ì•ˆ
            `);
        }

        // ë„ì›€ë§ ë²„íŠ¼ ì¶”ê°€
        window.onload = function() {
            loadSavedData();
            updateStatistics();
            renderTable();
            
            // ë„ì›€ë§ ë²„íŠ¼ ìƒì„±
            const helpButton = document.createElement('button');
            helpButton.className = 'btn';
            helpButton.innerHTML = 'â“ ë„ì›€ë§';
            helpButton.style.position = 'fixed';
            helpButton.style.bottom = '20px';
            helpButton.style.right = '20px';
            helpButton.style.zIndex = '1000';
            helpButton.onclick = showHelp;
            document.body.appendChild(helpButton);
        };

        // ë°˜ì‘í˜• í…Œì´ë¸”
        function makeTableResponsive() {
            const table = document.getElementById('dataTable');
            if (window.innerWidth <= 768) {
                table.style.fontSize = '12px';
            } else {
                table.style.fontSize = '14px';
            }
        }

        window.addEventListener('resize', makeTableResponsive);
        makeTableResponsive();

        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
        function validateMeasurementData(data) {
            const errors = [];
            
            if (!data.ssid || data.ssid.trim() === '') {
                errors.push('ë„¤íŠ¸ì›Œí¬ ì´ë¦„ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
            }
            
            if (!data.signal || data.signal > -20 || data.signal < -100) {
                errors.push('ì‹ í˜¸ ê°•ë„ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (-100 ~ -20 dBm)');
            }
            
            if (!data.channel || data.channel < 1 || data.channel > 165) {
                errors.push('ì±„ë„ ë²ˆí˜¸ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            
            if (!data.location || data.location.trim() === '') {
                errors.push('ì¸¡ì • ìœ„ì¹˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
            
            return errors;
        }

        // ê³ ê¸‰ í†µê³„ ê³„ì‚°
        function calculateAdvancedStats() {
            if (measurementData.length === 0) return {};
            
            const stats = {
                locationStats: {},
                securityStats: {},
                signalStats: {
                    min: Math.min(...measurementData.map(d => d.signal)),
                    max: Math.max(...measurementData.map(d => d.signal)),
                    avg: Math.round(measurementData.reduce((sum, d) => sum + d.signal, 0) / measurementData.length)
                },
                channelStats: {}
            };
            
            // ìœ„ì¹˜ë³„ í†µê³„
            measurementData.forEach(data => {
                if (!stats.locationStats[data.location]) {
                    stats.locationStats[data.location] = { count: 0, avgSignal: 0, riskHigh: 0 };
                }
                stats.locationStats[data.location].count++;
                if (data.riskLevel === 'high') {
                    stats.locationStats[data.location].riskHigh++;
                }
            });
            
            // ë³´ì•ˆ ë°©ì‹ë³„ í†µê³„
            measurementData.forEach(data => {
                stats.securityStats[data.security] = (stats.securityStats[data.security] || 0) + 1;
            });
            
            // ì±„ë„ë³„ í†µê³„
            measurementData.forEach(data => {
                stats.channelStats[data.channel] = (stats.channelStats[data.channel] || 0) + 1;
            });
            
            return stats;
        }

        // ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±
        function generateAnalysisReport() {
            const stats = calculateAdvancedStats();
            
            if (measurementData.length === 0) {
                alert('ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const report = `
WiFi ë³´ì•ˆ ë¶„ì„ ë¦¬í¬íŠ¸
ìƒì„±ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}
ì´ ì¸¡ì • ë„¤íŠ¸ì›Œí¬: ${measurementData.length}ê°œ

=== ë³´ì•ˆ í˜„í™© ===
${Object.entries(stats.securityStats).map(([security, count]) => 
    `${security}: ${count}ê°œ (${Math.round(count/measurementData.length*100)}%)`
).join('\n')}

=== ì‹ í˜¸ ê°•ë„ í†µê³„ ===
ìµœê°• ì‹ í˜¸: ${stats.signalStats.max} dBm
ìµœì•½ ì‹ í˜¸: ${stats.signalStats.min} dBm
í‰ê·  ì‹ í˜¸: ${stats.signalStats.avg} dBm

=== ìœ„í—˜ë„ í‰ê°€ ===
ë†’ì€ ìœ„í—˜: ${measurementData.filter(d => d.riskLevel === 'high').length}ê°œ
ë³´í†µ ìœ„í—˜: ${measurementData.filter(d => d.riskLevel === 'medium').length}ê°œ
ë‚®ì€ ìœ„í—˜: ${measurementData.filter(d => d.riskLevel === 'low').length}ê°œ

=== ê¶Œê³ ì‚¬í•­ ===
${generateRecommendations(stats)}
            `;
            
            // ìƒˆ ì°½ì—ì„œ ë¦¬í¬íŠ¸ í‘œì‹œ
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                    <head><title>WiFi ë³´ì•ˆ ë¶„ì„ ë¦¬í¬íŠ¸</title></head>
                    <body style="font-family: monospace; white-space: pre-wrap; padding: 20px;">
                        ${report}
                        <br><br>
                        <button onclick="window.print()">ì¸ì‡„</button>
                        <button onclick="window.close()">ë‹«ê¸°</button>
                    </body>
                </html>
            `);
        }

        // ê¶Œê³ ì‚¬í•­ ìƒì„±
        function generateRecommendations(stats) {
            const recommendations = [];
            
            const openCount = stats.securityStats['Open'] || 0;
            if (openCount > 0) {
                recommendations.push(`â€¢ ${openCount}ê°œì˜ ë³´ì•ˆë˜ì§€ ì•Šì€ ë„¤íŠ¸ì›Œí¬ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰ì‹œ ë³´ì•ˆ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
            }
            
            const wepCount = stats.securityStats['WEP'] || 0;
            if (wepCount > 0) {
                recommendations.push(`â€¢ ${wepCount}ê°œì˜ WEP ë³´ì•ˆ ë„¤íŠ¸ì›Œí¬ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. WPA2 ì´ìƒìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.`);
            }
            
            const weakSignals = measurementData.filter(d => d.signal < -70).length;
            if (weakSignals > measurementData.length * 0.3) {
                recommendations.push('â€¢ ì‹ í˜¸ê°€ ì•½í•œ ì§€ì—­ì´ ë§ìŠµë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ ì¶”ê°€ ì„¤ì¹˜ë¥¼ ê²€í† í•˜ì„¸ìš”.');
            }
            
            if (recommendations.length === 0) {
                recommendations.push('â€¢ ì „ë°˜ì ìœ¼ë¡œ ì–‘í˜¸í•œ ë³´ì•ˆ ìƒíƒœì…ë‹ˆë‹¤. ì •ê¸°ì ì¸ ì ê²€ì„ ê³„ì† ìˆ˜í–‰í•˜ì„¸ìš”.');
            }
            
            return recommendations.join('\n');
        }

        // ë¦¬í¬íŠ¸ ìƒì„± ë²„íŠ¼ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            const exportSection = document.querySelector('.export-section');
            if (exportSection) {
                const reportButton = document.createElement('button');
                reportButton.className = 'btn';
                reportButton.innerHTML = 'ğŸ“‹ ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±';
                reportButton.onclick = generateAnalysisReport;
                exportSection.insertBefore(reportButton, exportSection.lastElementChild);
            }
        });
    </script>
</body>
</html>